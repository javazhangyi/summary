30-如何使用redis 实现分布式锁
  分布式锁是储存在共享的储存系统中，可以被多个客户端访问和获取
  分布式锁的要求
    在加锁和释放锁的过程中，必须是一个原子性操作
    如果共享系统发生故障，需要保证共享系统的可靠性

  实现：
    单点：
      SET-NX
      DEL
      问题：中间发生异常，锁得不到过期
      解决方法：设置一个过期时间

      问题：其他客户端失误释放是，造成两个客户端，同时操作锁
      解决方法：不同的客户端，设置不同值，释放锁的时候，判断是否值属于自己

    集群：锁变量需要一个共享存储系统维护
      Redlock：客户端想多个独立的redis 一次请求加锁，只有超过一半，就表示加锁成功
      步骤：
        客户端获取当期时间
        客户端依次向N个redis 实例加锁（操作和单点一样），如果成功或者失败请求下一下
        完成加锁，计算加锁耗时

      判断加锁成功（同时满足）
        超过一半加锁成功
        加锁没有超过锁的有效时间（最后重新计算锁的有效时间）




要求
    实现分布式锁，涉及多个操作，要保证这个过程是原子性的
    共享存储保存了锁变量，如果系统发生故障，客户端无法进行锁操作，必要保证锁的一个可靠性

    单点分布式锁的实现
        加锁
            setnx key value
            set key value nx px ttl
        释放锁
            lua

    多点分布式锁的实现
        RedLock：依次请求相关节点，如果一半请求成功，那就成功


其他分布式锁的实现
    mysql
    zookeep

分布式事务
    二阶段提交
    三阶段提交
    tcc
    消息队列


